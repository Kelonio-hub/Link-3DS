<script>
// Objeto de traducciones
const translations = {
    es: {
        title: "Enlace Manual",
        loading: "Cargando enlace...",
        linkText: "Click <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Abrir archivos en pestañas nuevas\">aquí</a> para acceder a los archivos.",
        linkTextSpecial: "Click <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Abrir archivos en pestañas nuevas\">aquí</a> para acceder a los archivos. Nota: También se abrirá un archivo relacionado en otra pestaña.",
        youtube: "YouTube",
        discord: "Discord",
        twitter: "Twitter",
        github: "GitHub",
        kofi: "Ko-fi",
        processing: "Procesando, por favor espera...",
        selectLanguage: "Seleccionar idioma"
    },
    en: {
        title: "Manual Link",
        loading: "Loading link...",
        linkText: "Click <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Open files in new tabs\">here</a> to access the files.",
        linkTextSpecial: "Click <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Open files in new tabs\">here</a> to access the files. Note: An additional related file will open in another tab.",
        youtube: "YouTube",
        discord: "Discord",
        twitter: "Twitter",
        github: "GitHub",
        kofi: "Ko-fi",
        processing: "Processing, please wait...",
        selectLanguage: "Select language"
    },
    fr: {
        title: "Lien Manuel",
        loading: "Chargement du lien...",
        linkText: "Cliquez <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Ouvrir les fichiers dans de nouveaux onglets\">ici</a> pour accéder aux fichiers.",
        linkTextSpecial: "Cliquez <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Ouvrir les fichiers dans de nouveaux onglets\">ici</a> pour accéder aux fichiers. Note : Un fichier connexe s'ouvrira dans un autre onglet.",
        youtube: "YouTube",
        discord: "Discord",
        twitter: "Twitter",
        github: "GitHub",
        kofi: "Ko-fi",
        processing: "En cours, veuillez patienter...",
        selectLanguage: "Sélectionner la langue"
    },
    it: {
        title: "Link Manuale",
        loading: "Caricamento del link...",
        linkText: "Clicca <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Apri i file in nuove schede\">qui</a> per accedere ai file.",
        linkTextSpecial: "Clicca <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Apri i file in nuove schede\">qui</a> per accedere ai file. Nota: Un file correlato si aprirà in un'altra scheda.",
        youtube: "YouTube",
        discord: "Discord",
        twitter: "Twitter",
        github: "GitHub",
        kofi: "Ko-fi",
        processing: "Elaborazione in corso...",
        selectLanguage: "Seleziona lingua"
    },
    pt: {
        title: "Link Manual",
        loading: "Carregando link...",
        linkText: "Clique <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Abrir arquivos em novas abas\">aqui</a> para acessar os arquivos.",
        linkTextSpecial: "Clique <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Abrir arquivos em novas abas\">aqui</a> para acessar os arquivos. Nota: Um arquivo relacionado será aberto em outra aba.",
        youtube: "YouTube",
        discord: "Discord",
        twitter: "Twitter",
        github: "GitHub",
        kofi: "Ko-fi",
        processing: "Processando, por favor aguarde...",
        selectLanguage: "Selecionar idioma"
    },
    de: {
        title: "Manueller Link",
        loading: "Link wird geladen...",
        linkText: "Klicken Sie <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Dateien in neuen Tabs öffnen\">hier</a>, um auf die Dateien zuzugreifen.",
        linkTextSpecial: "Klicken Sie <a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"Dateien in neuen Tabs öffnen\">hier</a>, um auf die Dateien zuzugreifen. Hinweis: Eine zusätzliche Datei wird in einem weiteren Tab geöffnet.",
        youtube: "YouTube",
        discord: "Discord",
        twitter: "Twitter",
        github: "GitHub",
        kofi: "Ko-fi",
        processing: "Verarbeitung, bitte warten...",
        selectLanguage: "Sprache auswählen"
    },
    ja: {
        title: "マニュアルリンク",
        loading: "リンクを読み込んでいます...",
        linkText: "<a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"新しいタブでファイルを開く\">ここ</a>をクリックしてファイルにアクセスしてください。",
        linkTextSpecial: "<a onclick=\"abrirEnlace('{url}')\" id=\"mediafire-link\" aria-label=\"新しいタブでファイルを開く\">ここ</a>をクリックしてファイルにアクセスしてください。注：関連ファイルが別のタブで開きます。",
        youtube: "YouTube",
        discord: "Discord",
        twitter: "Twitter",
        github: "GitHub",
        kofi: "Ko-fi",
        processing: "処理中、お待ちください...",
        selectLanguage: "言語を選択"
    }
};

function mostrarEnlace(lang = 'es') {
    try {
        document.documentElement.lang = lang;
        document.title = translations[lang].title;

        const urlParams = new URLSearchParams(window.location.search);
        const formId = urlParams.get('form') || '1';

        const mediaFireLinks = {
            '1': 'https://www.mediafire.com/folder/v5ajkg685pv3d/3DS+A+CIA',
            '2': 'https://www.mediafire.com/folder/bhk7qkm3h3q8w/3DSX+A+CIA',
            '3': 'https://www.mediafire.com/folder/jfwm25wpndcmq/A9LH+A+BOOT9',
            '4': 'https://www.mediafire.com/folder/amnb6678bsyl4/ACT3DS-13.3.2',
            '5': 'https://www.mediafire.com/folder/rhd4xcgmrhwry/Anemone',
            '6': 'https://www.mediafire.com/folder/45imcjc6kz8r3/BAX',
            '7': 'https://www.mediafire.com/folder/kwzvcjuwcqyh0/Beeshop',
            '8': 'https://www.mediafire.com/folder/thjv7mmtxojiq/Botones+-+Comprobar',
            '9': 'https://www.mediafire.com/folder/56ngme6k652r5/Checkpoint',
            '10': 'https://www.mediafire.com/folder/kke89n2ub92u2/CIA+A+3DS',
            '11': 'https://www.mediafire.com/folder/m20yt1nr9r83d/Crash+Network',
            '12': 'https://www.mediafire.com/folder/cyk0r4kclllah/Custom-Install',
            '13': 'https://www.mediafire.com/folder/dkkh6ap9ggye9/DSP1',
            '14': '', // Añade un enlace válido o elimina esta entrada
            '15': 'https://www.mediafire.com/folder/0zt9r33vja6j5/Faketik',
            '16': 'https://www.mediafire.com/folder/ldz0g5ai1xfq9/FBI-Inject',
            '17': 'https://www.mediafire.com/folder/9xkkpcoa51lo3/FREAKYHAX',
            '18': 'https://www.mediafire.com/folder/kf75yszaldh2t/FTPD',
            '19': 'https://www.mediafire.com/folder/qwhiphqje9pu2/JKSM',
            '20': 'https://www.mediafire.com/folder/f3q1jzxxqfmza/KARTMINER7',
            '21': 'https://www.mediafire.com/folder/0xt2fp792njxy/KARTDLPHAX',
            '22': 'https://www.mediafire.com/folder/kehqp0k8jeb33/LimePlayer3DS',
            '23': 'https://www.mediafire.com/folder/my2byfq5f8wc9/LOS3D',
            '24': 'https://www.mediafire.com/folder/4o5890hs03vcv/Mandos+ps3-4',
            '25': 'https://www.mediafire.com/folder/b0f0cwse8ehom/Menuhax67',
            '26': 'https://www.mediafire.com/folder/e6vdyg8wh3zvt/Movable+Format',
            '27': 'https://www.mediafire.com/folder/w66tn7fmfedkt/MSET9',
            '28': 'https://www.mediafire.com/folder/f7nlpuxx74bbc/MUNDO+POKÉMON',
            '29': 'https://www.mediafire.com/folder/xz05bp0uardjo/NAND-REX',
            '30': 'https://www.mediafire.com/folder/julgldoln9bpq/NINJHAX',
            '31': 'https://www.mediafire.com/folder/limmurzf86jgf/NTRBootSelector',
            '32': 'https://www.mediafire.com/folder/kz04zhseec6xv/NTRBOOTHAX',
            '33': 'https://www.mediafire.com/folder/hbc59j4z5758q/Online+-+Pretendo',
            '34': 'https://www.mediafire.com/folder/rhdoro6ay4npl/PCP',
            '35': 'https://www.mediafire.com/folder/i81lqs1z56i0t/RETRO+A+CIA',
            '36': 'https://www.mediafire.com/folder/cft1snmezruhh/Arreglar+Cartuchos',
            '37': 'https://www.mediafire.com/folder/jtr2xnok55esm/SAFECERTHAX',
            '38': 'https://www.mediafire.com/folder/sbywp6mmubgyr/SDLoader-GX',
            '39': 'https://www.mediafire.com/folder/nmosl75asd6on/SlotTool',
            '40': 'https://www.mediafire.com/folder/58dr0nisioo3t/SUPERSKATER',
            '41': 'https://www.mediafire.com/folder/3gh029nhpx9hu/Sysupdater',
            '42': 'https://www.mediafire.com/folder/2sl0ilv9vsq2i/Themely',
            '43': 'https://www.mediafire.com/folder/rzjqxtucd9e1c/TikSweep',
            '44': 'https://www.mediafire.com/folder/2qrmkk04es3k1/TinyFormat',
            '45': 'https://www.mediafire.com/folder/2j8jct3zqid3c/Titlerex',
            '46': 'https://www.mediafire.com/folder/k2tyuakfma22o/TRIMEAR+JUEGOS',
            '47': 'https://www.mediafire.com/folder/qydjc55abxhd2/Youtube',
            '48': 'https://www.mediafire.com/folder/ti8l2it4b864f/Tuna_Videos',
            '49': 'https://www.mediafire.com/folder/mcc7anopqy80a/TWLmenu',
            '50': 'https://www.mediafire.com/folder/uvlryhaul8fpp/TWLFix',
            '51': 'https://www.mediafire.com/folder/3ww44qjpx2vpz/Universal',
            '52': 'https://www.mediafire.com/folder/v6k5t5r28uwsk/Godmode9+2.2.0',
            '53': 'https://www.mediafire.com/folder/whnssjlczk1vs/ARCHIVO+CTRNAND+11.15',
            '54': 'https://www.mediafire.com/folder/3qw73cb3bma7e/SCRIPT+CTRNAND+v25.1',
            '55': 'https://www.mediafire.com/folder/4ww5elj11unm0/SCRIPT+CTRNAND-2',
            '56': 'https://www.mediafire.com/folder/wfigzf3ti9mhb/SCRIPT+BLACK+LAZARUS+v25.1',
            '57': 'https://www.mediafire.com/folder/aw57qm6owltz1/SCRIPT+BLUE+LAZARUS',
            '58': 'https://n9.cl/en7r6j', // KERNEL R4
            '59': 'https://www.mediafire.com/folder/1yfs92z21v0vf/SCRIPT+ELIMINAR+HACK', // Reasignado
            '100': ''
        };

        const mediaFireUrl = mediaFireLinks[formId] || mediaFireLinks['1'];
        const idsEspeciales = ['54', '55', '56'];
        const linkText = idsEspeciales.includes(formId) 
            ? translations[lang].linkTextSpecial.replace('{url}', mediaFireUrl)
            : translations[lang].linkText.replace('{url}', mediaFireUrl);

        document.body.innerHTML = `
            <div class="footer">
                <div class="social-buttons">
                    <a href="https://www.youtube.com/@Kelonio3DS" target="_blank" class="social-button">
                        <img src="https://www.youtube.com/favicon.ico" alt="YouTube"> ${translations[lang].youtube}
                    </a>
                    <a href="https://discord.gg/8Fv8GDg" target="_blank" class="social-button">
                        <img src="https://images.icon-icons.com/3053/PNG/512/discord_macos_bigsur_icon_190238.png" alt="Discord"> ${translations[lang].discord}
                    </a>
                    <a href="https://x.com/Kelonio3DS" target="_blank" class="social-button">
                        <img src="https://cdn-icons-png.flaticon.com/512/5969/5969020.png" alt="X"> ${translations[lang].twitter}
                    </a>
                    <a href="https://github.com/Kelonio-hub" target="_blank" class="social-button">
                        <img src="https://github.githubassets.com/favicons/favicon-dark.png" alt="GitHub"> ${translations[lang].github}
                    </a>
                    <a href="https://ko-fi.com/lapresa" target="_blank" class="social-button">
                        <img src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/ko-fi-icon.png" alt="Ko-fi"> ${translations[lang].kofi}
                    </a>
                </div>
            </div>
            <div class="content">
                <p>${linkText}</p>
                <div id="loading" aria-live="polite">${translations[lang].processing}</div>
            </div>
            <div class="language-selector">
                <label for="language-select" style="color: white;">${translations[lang].selectLanguage}</label>
                <select id="language-select" onchange="mostrarEnlace(this.value)">
                    <option value="es" ${lang === 'es' ? 'selected' : ''}>Español</option>
                    <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
                    <option value="fr" ${lang === 'fr' ? 'selected' : ''}>Français</option>
                    <option value="it" ${lang === 'it' ? 'selected' : ''}>Italiano</option>
                    <option value="pt" ${lang === 'pt' ? 'selected' : ''}>Português</option>
                    <option value="de" ${lang === 'de' ? 'selected' : ''}>Deutsch</option>
                    <option value="ja" ${lang === 'ja' ? 'selected' : ''}>日本語</option>
                </select>
            </div>
        `;
    } catch (error) {
        console.error('Error en mostrarEnlace:', error);
        document.body.innerHTML = `
            <div class="content">
                <p>Error al cargar el contenido: ${error.message}. Por favor, intenta de nuevo.</p>
            </div>
        `;
    }
}

function abrirEnlace(mediaFireUrl) {
    const amazonUrl = 'https://amzn.to/4lJC3tK'; // Considera usar la URL completa de Amazon
    const lang = document.documentElement.lang || 'es';
    const urlParams = new URLSearchParams(window.location.search);
    const formId = urlParams.get('form') || '1';

    try {
        const loadingDiv = document.getElementById('loading');
        loadingDiv.style.display = 'block';
        loadingDiv.innerText = translations[lang].processing;

        // Abre el enlace principal de MediaFire en una pestaña nueva
        window.open(mediaFireUrl, '_blank');

        // Si el formId es 54, 55 o 56, abre también el enlace de form=53
        const idsEspeciales = ['54', '55', '56'];
        if (idsEspeciales.includes(formId)) {
            const enlaceForm53 = mediaFireLinks['53'];
            if (enlaceForm53) {
                window.open(enlaceForm53, '_blank');
            } else {
                console.warn('El enlace para el formulario ID 53 no está definido.');
            }
        }

        // Redirige a Amazon después de un retraso
        setTimeout(() => {
            loadingDiv.style.display = 'none';
            window.location.href = amazonUrl;
        }, 500); // Retraso aumentado para mejor experiencia
    } catch (error) {
        console.error('Error en abrirEnlace:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('loading').innerText = translations[lang].processing;
    }
}

window.onload = () => {
    try {
        mostrarEnlace('es'); // Español por defecto
    } catch (error) {
        console.error('Error en window.onload:', error);
        document.body.innerHTML = `
            <div class="content">
                <p>Error al cargar la página: ${error.message}. Por favor, intenta de nuevo.</p>
            </div>
        `;
    }
};
</script>